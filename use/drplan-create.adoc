---
sidebar: sidebar 
permalink: use/drplan-create.html 
keywords: disaster recovery, bluexp disaster recovery, failover, failback, replicate, fail over, fail back, vmware, vcenter, replication plan, protection, disaster, recovery 
summary: A recuperação de desastres do NetApp BlueXP  é um serviço de recuperação de desastres baseado na nuvem que automatiza os workflows de recuperação de desastres. Depois de adicionar o vCenter Sites, você estará pronto para criar um plano de recuperação de desastres ou replicação. 
---
= Crie um plano de replicação
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/use/


[role="lead"]
Depois de adicionar o vCenter Sites, você estará pronto para criar uma recuperação de desastres ou _plano de replicação_. Selecione os vCenters de origem e destino, escolha os grupos de recursos e agrupe como os aplicativos devem ser restaurados e ativados. Por exemplo, você pode agrupar máquinas virtuais associadas a um aplicativo ou agrupar aplicativos com níveis semelhantes.

Tais planos são às vezes chamados _blueprints_.

Você pode criar um plano de replicação e também editar programações para conformidade e teste.



== Crie o plano

Um assistente leva você através destes passos:

* Selecione vCenter Servers.
* Selecione as VMs que deseja replicar e atribuir grupos.
* Mapear como os recursos do ambiente de origem são mapeados para o destino.
* Identificar recorrência, executar um script Guest-hospedado, definir a ordem de inicialização e selecionar o objetivo do ponto de recuperação.
* Reveja o plano.


Ao criar o plano de replicação, você pode definir a relação do SnapMirror entre os volumes de origem e destino em uma das seguintes configurações:

* 1 a 1
* 1 para muitos em uma arquitetura de fanout
* Muitos a 1 em um Grupo de consistência
* Muitos a muitos


.Antes de começar
Se você quiser criar um relacionamento SnapMirror nesse serviço, o cluster e seu peering SVM já devem ter sido configurados fora da recuperação de desastres do BlueXP .



=== Selecione vCenter Servers

Primeiro, você seleciona o vCenter de origem e, em seguida, seleciona o vCenter de destino.

.Passos
. No sistema de navegação esquerdo do BlueXP , selecione *proteção* > *recuperação de desastres*.
. No menu superior da recuperação de desastres do BlueXP , selecione *planos de replicação* e selecione *Adicionar*. Ou, se você estiver apenas começando a usar o serviço, no Painel, selecione *Adicionar plano de replicação*.
+
image:dr-plan-create-name.png["Captura de ecrã que mostra a página Adicionar plano de replicação > Adicionar plano"]

. Crie um nome para o plano de replicação.
. Selecione os vCenters de origem e destino nas listas vCenter de origem e destino.
. Selecione *seguinte*.




=== Selecione aplicativos para replicar e atribuir grupos de recursos

A próxima etapa é agrupar as máquinas virtuais necessárias em grupos de recursos funcionais. Os grupos de recursos permitem agrupar um conjunto de máquinas virtuais dependentes em grupos lógicos que atendam aos seus requisitos. Por exemplo, grupos podem conter ordens de inicialização atrasadas que podem ser executadas após a recuperação.


TIP: Cada grupo de recursos pode incluir uma ou mais máquinas virtuais. As máquinas virtuais serão ligadas com base na sequência em que as incluir aqui.

.Passos
. No lado esquerdo da página aplicativos, opcionalmente, procure armazenamentos de dados.
. No lado esquerdo da página aplicativos, selecione as máquinas virtuais que você deseja replicar e atribuir ao grupo selecionado.
+
A máquina virtual selecionada é adicionada automaticamente ao grupo 1 e um novo grupo 2 é iniciado. Cada vez que você adiciona uma máquina virtual ao último grupo, outro grupo é adicionado.

+
image:dr-plan-create-apps-vms4.png["Captura de ecrã que mostra a página Adicionar plano de replicação > aplicações a replicar"]

. Opcionalmente, faça um dos seguintes procedimentos:
+
** Para alterar grupos, clique no ícone *Edit* do grupoimage:icon-pencil.png["Ícone de lápis"].
** Para remover uma máquina virtual de um grupo, selecione *X*.
** Para mover uma máquina virtual para um grupo diferente, arraste e solte-a no novo grupo.


. Quando tiver vários grupos de recursos, certifique-se de que a sequência dos grupos corresponde à sequência operacional que deve ocorrer.
+
Cada máquina virtual dentro de um grupo é iniciada em sequência com base na ordem aqui. Dois grupos são iniciados em paralelo.

. Opcionalmente, renomeie o grupo clicando no ícone *Editar*.
. Selecione *seguinte*.




=== Mapeie os recursos de origem para o destino

Na etapa de mapeamento de recursos, especifique como os recursos do ambiente de origem devem ser mapeados para o destino.

.Antes de começar
Se você quiser criar um relacionamento SnapMirror nesse serviço, o cluster e seu peering SVM já devem ter sido configurados fora da recuperação de desastres do BlueXP .

.Passos
. Na página Mapeamento de recursos, para usar os mesmos mapeamentos para operações de failover e teste, marque a caixa .
+
image:dr-plan-resource-mapping2.png["Plano de replicação, separador Mapeamento de recursos"]

. Na guia Mapeamentos de failover, selecione a seta para baixo à direita de cada recurso e mapeie os recursos em cada um.
. *Recursos de computação*: Selecione a seta para baixo ao lado de *recursos de computação*.
. *Redes virtuais*: Na guia Mapeamentos de failover, selecione a seta para baixo ao lado de *redes virtuais*. Introduza ou selecione a LAN virtual de origem e o segmento de destino.
. *Máquinas virtuais*: Na guia Mapeamentos de failover, selecione a seta para baixo ao lado de *máquinas virtuais*.
+
Selecione o mapeamento de rede para o segmento apropriado. Os segmentos já devem ser provisionados, então selecione o segmento apropriado para mapear a máquina virtual.

+
Esta secção pode estar ativada ou desativada dependendo da sua seleção.

+
O SnapMirror está no nível do volume. Assim, todas as máquinas virtuais são replicadas para o destino de replicação. Certifique-se de selecionar todas as máquinas virtuais que fazem parte do datastore. Se não estiverem selecionadas, apenas as máquinas virtuais que fazem parte do plano de replicação serão processadas.

+
** *Tipo de endereço IP*: Quando você está mapeando redes entre locais de origem e destino na seção máquinas virtuais do plano de replicação, a recuperação de desastres do BlueXP  oferece duas opções: DHCP ou IP estático. Para IPs estáticos, configure os servidores de sub-rede, gateway e DNS. Além disso, insira credenciais para máquinas virtuais.
+
*** *DHCP*: Se você escolher essa opção, você fornecerá apenas as credenciais para a VM.
*** *Static IP*: Você pode selecionar a mesma informação ou informações diferentes da VM de origem. Se você escolher o mesmo que a origem, não precisará inserir credenciais. Por outro lado, se você optar por usar informações diferentes da origem, poderá fornecer as credenciais, o endereço IP da VM, a máscara de sub-rede, o DNS e as informações do gateway. As credenciais do sistema operacional convidado VM devem ser fornecidas para o nível global ou para cada nível de VM.
+
Isso pode ser muito útil ao recuperar ambientes grandes para clusters de destino menores ou para realizar testes de recuperação de desastres sem precisar provisionar uma infraestrutura VMware física um-para-um.

+
image:dr-plan-create-mapping-vms2.png["Captura de ecrã mostrando Adicionar plano de replicação > Mapeamento de recursos > máquinas virtuais"]



** *Source VM CPU e RAM*: Sob os detalhes das máquinas virtuais, você pode redimensionar opcionalmente os parâmetros CPU e RAM da VM.
** *Atraso de inicialização*: Você pode modificar a ordem de inicialização para todas as máquinas virtuais selecionadas nos grupos de recursos. Por padrão, a ordem de inicialização selecionada durante a seleção do grupo de recursos é usada; no entanto, você pode fazer alterações nesta etapa. Com este campo, você pode ajustar o atraso em minutos da ação de inicialização.
** *Criar réplicas consistentes com aplicativos*: Indique se deseja criar cópias Snapshot consistentes com aplicativos. O serviço desativará o aplicativo e, em seguida, fará uma captura Instantânea para obter um estado consistente do aplicativo.


. *Datastores*: Na guia Mapeamentos de failover, selecione a seta para baixo ao lado de *datastores*. Com base na seleção de máquinas virtuais, mapeamentos de datastore são selecionados automaticamente.
+
Esta secção pode estar ativada ou desativada dependendo da sua seleção.

+
** *RPO*: Digite o objetivo do ponto de recuperação (RPO) para indicar a quantidade de dados a serem recuperados (medido no tempo). Por exemplo, se você inserir um RPO de 60 minutos, a recuperação precisará ter dados que não tenham mais de 60 minutos o tempo todo. Se houver um desastre, você estará permitindo a perda de até 60 minutos de dados. Insira também o número de cópias Snapshot a serem mantidas em todos os datastores.
** *Contagem de retenção*: Insira o número de instantâneos que deseja reter.
** *Datastores de origem e destino*: Se um volume tiver uma relação SnapMirror já estabelecida, você poderá selecionar os datastores de origem e destino correspondentes. Se você selecionar um volume que não tenha um relacionamento com o SnapMirror, poderá criar um agora selecionando o ambiente de trabalho e seu SVM de pares.
+

NOTE: Se você quiser criar um relacionamento SnapMirror nesse serviço, o cluster e seu peering SVM já devem ter sido configurados fora da recuperação de desastres do BlueXP .

+
*** *Grupos de consistência*: Ao criar um plano de replicação, você pode incluir VMs de diferentes volumes e SVMs diferentes. A recuperação de desastres do BlueXP  cria uma consistência do Snapshot do grupo.


** Se você especificar o objetivo do ponto de recuperação (RPO), o serviço programará um backup primário com base no RPO e atualizará os destinos secundários.
** Se as VMs forem do mesmo volume e do mesmo SVM, o serviço executará um ONTAP Snapshot padrão e atualizará os destinos secundários.
** Se as VMs forem de volume diferente e mesmo SVM, o serviço criará um Snapshot de grupo de consistência, incluindo todos os volumes e atualizações dos destinos secundários.
** Se as VMs forem de volume diferente e SVM diferente, o serviço executará uma fase de início do Grupo de consistência e fará a atualização do Snapshot da fase de confirmação, incluindo todos os volumes no mesmo cluster ou diferente, além de atualizar os destinos secundários.
** Durante o failover, você pode selecionar qualquer Snapshot. Se você selecionar a Snapshot mais recente, o serviço criará backup sob demanda, atualizará o destino e usará essa Snapshot para o failover.


. Para definir mapeamentos diferentes para o ambiente de teste, desmarque a caixa e selecione a guia *Mapeamentos de teste*. Passe por cada guia como antes, mas desta vez para o ambiente de teste.
+
Na guia Mapeamentos de teste, os mapeamentos de máquinas virtuais e armazenamentos de dados são desativados.

+

TIP: Você pode testar mais tarde todo o plano. Neste momento, você está configurando os mapeamentos para o ambiente de teste.





=== Identificar a recorrência

Selecione se deseja migrar dados (uma movimentação única) para outro destino ou replicá-los na frequência SnapMirror.

Se você quiser replicá-los, identifique com que frequência os dados devem ser espelhados.

.Passos
. Na página de recorrência, selecione *Migrate* ou *replicate*.
+
** *Migrate*: Selecione para mover o aplicativo para o local de destino.
** *Replicate*: Mantenha a cópia de destino atualizada com as alterações da cópia de origem em uma replicação recorrente.


+
image:dr-plan-create-recurrence.png["Captura de ecrã que mostra Adicionar plano de replicação > recorrência"]

. Selecione *seguinte*.




=== Confirme o plano de replicação

Por fim, dedique alguns momentos para confirmar o plano de replicação.


TIP: Mais tarde, pode desativar ou eliminar o plano de replicação.

.Passos
. Revise as informações em cada guia: Detalhes do plano, Mapeamento de failover, VMs.
. Selecione *Adicionar plano*.
+
O plano é adicionado à lista de planos.





== Edite programações para testar a conformidade e garantir que os testes de failover funcionem

Você pode querer configurar programações para testar testes de conformidade e failover para garantir que eles funcionem corretamente caso você precise deles.

* *Impacto no tempo de conformidade*: Quando um plano de replicação é criado, o serviço cria um cronograma de conformidade por padrão. O tempo de conformidade padrão é de 30 minutos. Para alterar essa hora, você pode usar a opção Editar a programação no plano de replicação.
* *Impacto de failover de teste*: Você pode testar um processo de failover sob demanda ou por um cronograma. Isso permite testar o failover de máquinas virtuais para um destino especificado em um plano de replicação.
+
Um failover de teste cria um volume FlexClone, monta o datastore e move a carga de trabalho nesse datastore. Uma operação de failover de teste _não_ impacta as cargas de trabalho de produção, a relação SnapMirror usada no local de teste e as cargas de trabalho protegidas que devem continuar operando normalmente.



Com base na programação, o teste de failover é executado e garante que as cargas de trabalho estejam se movendo para o destino especificado pelo plano de replicação.

.Passos
. No menu superior da recuperação de desastres do BlueXP , selecione *planos de replicação*.
+
image:dr-plan-list.png["Captura de tela mostrando a lista de planos de replicação"]

. Selecione o ícone *ações* image:icon-horizontal-dots.png["Menu ações de pontos horizontais"]e selecione *Editar horários*.
. Digite com que frequência, em minutos, a recuperação de desastres do BlueXP  verifica a conformidade do teste.
. Para verificar se os testes de failover estão em bom estado, marque *Executar failovers em um cronograma mensal*.
+
.. Selecione o dia do mês e a hora em que deseja que esses testes sejam executados.
.. Introduza a data no formato aaaa-mm-dd quando pretender que o teste comece.
+
image:dr-plan-schedule-edit.png["Captura de tela mostrando onde você pode editar programações"]



. Para limpar o ambiente de teste após o término do teste de failover, marque *Limpar automaticamente após o failover de teste*.
+

NOTE: Esse processo desRegistra as VMs temporárias do local de teste, exclui o volume FlexClone que foi criado e desmonta os datastores temporários.

. Selecione *Guardar*.

